# Part 1B - SenseHAT Programs

In this step, you will write some Python programs that use the SenseHAT. 

## Shake It Up

Lets create a program that detects if the SenseHAT is moved abruptly by changing the  entire LED matrix colour. To do this we can use the accelerometer and LED matrix on the SenseHAT.

+ Create a folder on the Raspberry pi called **Week8-lab2** and "cd" into it: 

```cmd
mkdir week8-lab2
cd week8*
/week8-lab2 $
```

+ Create a new program called ``shakey,py`` with the following code:

~~~python
from sense_hat import SenseHat
import time

GREEN = (0, 255, 0)  # RGB for green
RED = (255, 0, 0)    # RGB for red

# Initialise Sense HAT
sense = SenseHat()
sense.clear(GREEN)  # Start with green color

# Define threshold for shake detection
SHAKE_THRESHOLD = 1.5  # Adjust as needed for sensitivity

def is_shaken():
    # Get raw accelerometer data
    shaken=False
    accel = sense.get_accelerometer_raw()
    x = abs(accel['x'])
    y = abs(accel['y'])
    z = abs(accel['z'])
    
    if x > SHAKE_THRESHOLD or y > SHAKE_THRESHOLD or z > SHAKE_THRESHOLD:
        shaken=True
    # Check if the acceleration exceeds the shake threshold on any axis
    return shaken


while True:
    if is_shaken():
        print("Shakey shakey")
        sense.clear(RED)  # Set LEDs to red
        time.sleep(1)  # Keep red for a second
        sense.clear(GREEN)  # Reset back to green

    # Short delay to prevent high CPU usage
    time.sleep(0.1)

~~~

A few things to observe about this program:

+ **`SHAKE_THRESHOLD`**: This is the acceleration threshold that determines if the RPi is shaken. You can adjust it to alter sensitivity.
+ **`is_shaken()` function**: Checks the  values of the accelerometer readings by retrieving the accelerometer sensor data (``accel = sense.get_accelerometer_raw()``. If any axis exceeds the threshold, it returns `True`, indicating a shake.
  The conditional statement  `if x > SHAKE_THRESHOLD or y > SHAKE_THRESHOLD or z > SHAKE_THRESHOLD:` uses the ``or`` operator to check each axis individually.
+ **LED Behaviour**: The LEDs turn red when shaken and stay red for 1 second before returning to green.

Now run the program and then shake your Raspberry Pi. The LEDs should go Red and the following outputted to the console:

~~~cmd
:~/week8-lab2 $ python shakey.py
Shakey shakey
Shakey shakey
Shakey shakey
Shakey shakey
~~~



## Turn It Over

Lets create a program that detects if the SenseHAT is rotated more than 90 degrees by changing the LED colour. To do this we can use the gyro and LED array.

+ in the same folder as the last program, create a new program called ``turny,py`` with the following code:

~~~python
from sense_hat import SenseHat
import time

GREEN = (0, 255, 0)  # RGB for green
RED = (255, 0, 0)    # RGB for red

# Initialise Sense HAT
sense = SenseHat()

# Define threshold for detecting a 90-degree rotation
ROTATION_THRESHOLD = 85  # Degrees (close to 90 for tolerance)

# Start with green LEDs
sense.clear(GREEN)  # Set LEDs to green

# Function to check if the Sense HAT has rotated 90 degrees
def detect_rotation():
    orientation = sense.get_orientation()
    pitch = orientation['pitch']
    roll = orientation['roll']
    yaw = orientation['yaw']
    
    # Check if any of the angles is approximately 90 degrees
    if (ROTATION_THRESHOLD <= pitch <= (ROTATION_THRESHOLD + 10) or
        ROTATION_THRESHOLD <= roll <= (ROTATION_THRESHOLD + 10) or
        ROTATION_THRESHOLD <= yaw <= (ROTATION_THRESHOLD + 10)):
        return True
    return False


while True:
    if detect_rotation():
        print("Sense HAT has been rotated!")
        sense.clear(RED)  # Set LEDs to red
        sense.show_message("Rotated 90!", scroll_speed=0.05, text_colour=[255, 0, 0])
        time.sleep(1)  # Keep red for a second
        sense.clear(GREEN)  # Reset back to green
    
    # Short delay to reduce CPU usage
    time.sleep(0.1)
~~~

### Press The Button

Lets create a program that will toggle the colour of the entire LED matrix between green and red each time the joystick (button) is pressed.

+ In the same folder as the last program, create a new program called ``pressit.py`` with the following code:

~~~python
from sense_hat import SenseHat
import time

sense = SenseHat()

# Define colours
GREEN = (0, 255, 0)  # RGB for green
RED = (255, 0, 0)    # RGB for red

# Initial state
is_green = True
sense.clear(GREEN)  # Start with green

while True:
    for event in sense.stick.get_events():
        print(event.direction, event.action)
        if event.action == "pressed":
            if is_green:
                sense.clear(RED)
            else:
                sense.clear(GREEN)
            is_green = not is_green
    time.sleep(0.1)  # Slight delay to avoid high CPU usage
~~~

+ Run the program and press the button on the SenseHAT. It should toggle the colour of the LEDs

A few things to note about this program:

+ **sense.stick.get_events()**: The program retrieves the joystick's event(``sense.stick.get_events()``) 

+ Each event has the following properties:

  + `event.direction`: The direction the joystick was moved (e.g., "up", "down", "left", "right", "middle").

    `event.action`: The type of action, such as "pressed" (button pressed) or "released" (button released).

+ The program checks if `event.action == "pressed"` to only respond to presses

+ Note how the ``is_green`` boolean value is toggled every time the button is pressed using the ``not`` keyword. 

# Exercise(Optional)

+ Using the above programs, create a new version of shakey.py called ``shakey_v2.py`` that allows you to toggle shake detection using the button. 

  + Then the program starts, by default shake detection is activated

  + Pressing  the button on the senseHAT deactivates/activates shake detection. 

  + If the shake detection is deactivated, the LED matrix should be switched off  (use ``sense.clear((0, 0, 0))``) todo this)

    HINT: Combine the button example with the shake detection example programs.