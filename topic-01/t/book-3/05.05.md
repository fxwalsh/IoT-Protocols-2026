# Configure the RPi

Now that you have connected to the RPi you can use the ``raspi-config`` utility to further configure the RPi.

## Before We Start...

...lets make sure the RPi is up to date. In the RPi SSH session, run the following commands:

```shell
sudo apt-get update
sudo apt-get upgrade
```

This will download package information and install available upgrades of all packages currently installed on the system.

## Wi-Fi Power Management

If you’re on **Wi-Fi**, the adapter often powers down to save energy when idle. This can cause the RPi to become unreachable on the network 

#### 1️⃣ Check if Wi-Fi power saving is on

`iw` is a **Linux command-line tool** for managing and querying wireless interfaces. To check the power saving config, run:

```
iw wlan0 get power_save
```

If it says `Power save: on`, you will need to switch it off. 

------

#### 2️⃣Turn off Wi-Fi power saving permanently

Create a config file for NetworkManager:

```
sudo mkdir -p /etc/NetworkManager/conf.d
sudo nano /etc/NetworkManager/conf.d/wifi-powersave.conf
```

Add the following:

```
[connection]
wifi.powersave = 2
```

**Meaning:**

- `0` = default
- `2` = disable power saving (keeps Wi-Fi always awake)

Then restart NetworkManager:

```
sudo systemctl restart NetworkManager
```

Or simply reboot:

```
sudo reboot
```

After reboot, confirm it worked:

```
iw wlan0 get power_save
```

It should now say `Power save: off`.


## Expand rootfs
Typically, Raspberry Pi OS images are 2 GB. When you copy the image to a larger SD card then a large portion of the  card may be left unused. To make this available to Raspberry Pi OS, and the apps installed on the RPi, you can expand it to  fill the rest of the SD card.  

+ At the command prompt in the the RPi SSH session, enter ``sudo raspi-config``. This will show the following:   
  <img src="./img/image-20251102155249340.png" alt="image-20251102155249340" style="zoom:50%;" />

+ In the Raspi-config tool, select *Advanced Options->Expand Filesystem*

![Expand rootfs Partition](./img/expand-filesystem1.png)  

You should be informed that the resize will take place on the next reboot of the RPi.





## **OPTIONAL: Set a Static IP**

As you know from networking content on the module, if your router’s DHCP lease expires, your Pi’s IP might change and become unreachable. This could be an issue if you use the IP address for your SSH connection. If mDNS is working reliably for you(i.e. you use the hostname hdipRpi.local), you may not need to do this.  

### 1️⃣ Find your current connection name

On the RPi, run:

```
nmcli connection show
```

You’ll see something like:

```
NAME                UUID                                  TYPE      DEVICE
preconfigured       0c4a03d1-35e5-4988-b5e7-a8b50adf7988  wifi      wlan0
lo                  2f8a5a5e-1290-4db1-8c70-c423fc4b95fe  loopback  lo
```

The wifi  **connection name** is `preconfigured`. Lets change this to be something more meaningful. Run the following:

~~~
sudo nmcli connection modify preconfigured connection.id home_wifi
~~~

We'll use this in the next part. 

------

### 2️⃣ Check your current IP and gateway

We would like to see our current IP address,mask and default gateway

Run:

```
ip addr show wlan0
```

This shows the ip address for your wifi interface. It will be similar to this:
~~~
3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 88:a2:9e:3a:91:7b brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.123/24 brd 192.168.1.255 scope global noprefixroute wlan0
       valid_lft forever preferred_lft forever
    inet6 fe80::8aa2:9eff:fe3a:917b/64 scope link proto kernel_ll
       valid_lft forever preferred_lft forever
~~~

So the   **ip address** is `192.168.1.123/24` (yours will be different)

Now run the following: 

```
ip route | grep default
```

You’ll see something like:

```
default via 192.168.1.1 dev wlan0
```

So your **default gateway** is `192.168.1.1`.(yours could be different)



------

### 3️⃣ Set the static IP

Ideally you would pick an unused IP address that is outside the DHCP lease range. For a home Wifi set up, Typical steps to do this are:

1. Open your router’s web interface in a browser using the default gateway address from the last step:
    (Usually `http://192.168.1.1` or `http://192.168.0.1`.)

2. Log in (default credentials are often printed on the router).

3. Look for a section called something like:

   - **LAN Setup**
   - **DHCP Server**
   - **Network Settings**

4. You’ll see something like:

   ```
   DHCP Server: Enabled
   Start IP: 192.168.1.100
   End IP:   192.168.1.199
   Lease Time: 24 hours
   ```

That means any IP between `.100` and `.199` is dynamically assigned,
 so you should pick a **static IP outside that range**, e.g., `192.168.1.50`.

Once you decide on the IP address you wish to assign, Run:

```
sudo nmcli connection modify home_wifi ipv4.addresses 192.168.1.50/24
sudo nmcli connection modify home_wifi ipv4.gateway 192.168.1.1
sudo nmcli connection modify home_wifi ipv4.dns 192.168.1.1
sudo nmcli connection modify home_wifi ipv4.method manual
```

*( adjust the IP address and gateway based on what you found in the last steps.)*

------

### 4️⃣ Apply the change

Either restart the connection:

```
sudo nmcli connection down home_wifi && sudo nmcli connection up home_wifi
```

Or simply reboot:

```
sudo reboot
```

Both of these steps will cause your ssh session to disconnect - connect as usual again but give a little time for the changes and/or reboot to take affect. 

------



### 5️⃣ Verify

After reboot, connect to ssh and check:

```
ip addr show wlan0
```

It should now show your new address:

```
inet 192.168.1.50/24 ...
```

