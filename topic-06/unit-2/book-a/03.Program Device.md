# Install Blynk Library on the Raspberry Pi 3 B+

We will use ``Python`` Blynk library to control the RPi.


## Create your Blynk App


+ SSH into your Raspberry Pi and make a new folder for your Blynk project, *~/week9-lab1/blynk*.


+ At the command line, run the following to install the Blynk dependencies for Python 3

~~~text
sudo pip install https://bit.ly/3C0PMVY
~~~

+ In the ``~/week9-lab2/blynk`` folder, create a new file called ``blynk.py`` with the following content, replacing the value assigned to BLYNK_AUTH with your auth key:

```python
import BlynkLib
from time import sleep

BLYNK_AUTH = 'YOUR-AUTH-TOKEN'
# initialize Blynk
blynk = BlynkLib.Blynk(BLYNK_AUTH)

# register handler for virtual pin V0 write event
@blynk.on("V0")
def v3_write_handler(value):
    buttonValue=value[0]
    print(f'Current button value: {buttonValue}')

# infinite loop that waits for event
while True:
    blynk.run()
 	sleep(.5)
```

+ Replace ``YOUR-AUTH-TOKEN`` by selecting the Device Info tab for the SensePi device and copy/pasting the Auth Token(you will get an option to copy it when you pass the mouse pointer over it)
  <img src="./img/auth.PNG" alt="image-20221108121819412" style="zoom:50%;" />

The above script creates a ``Virtual Pin`` on your Raspberry Pi. You can use this to interface, display and send data with your Blynk app on your phone.

+ Run the script by opening a terminal window and entering ``python blynk.py`` at the command line. You should see the following output:

![Blynk Node connection](./img/blynk1.png)

+ Leave the program running on the RPi 

+ Go back to the Blynk Management App in the browser and select the "Dashboard" tab. Toggle the button control a few times on the Dashboard. You should see the values come through on the RPi. You can now control stuff on the RPi from this dashboard, from any browser, if you wish!
  ![Control](./img/brow.png)
  
  

## Sensehat

Next let's hook up the SenseHat to the virtual pin and use it to control the LEDs.

+ On the RPi, do a keyboard interrupt(ctrl+c) to stop the program.
+ Replace *blynk.py* with the following:

~~~python
import BlynkLib
from sense_hat import SenseHat
from time import sleep

BLYNK_AUTH = 'sLrqnnrNODdNk-AxYGhxjyK-FC3heEev'
# initialize Blynk
blynk = BlynkLib.Blynk(BLYNK_AUTH)

#initialise SenseHAT
sense = SenseHat()
sense.clear()

# register handler for virtual pin V0 write event
@blynk.on("V0")
def v3_write_handler(value):
    buttonValue=value[0]
    print(f'Current button value: {buttonValue}')
    if buttonValue=="1":
        sense.clear(255,255,255)
    else:
        sense.clear()

# infinite loop that waits for event
while True:
    blynk.run()
    sleep(0.5) # sleep for .5 second
~~~

There's not much change to the code here apart from introducing the SenseHAT library to control the LEDs.

In the next step, we'll do this from a Blynk Mobile phone app.

