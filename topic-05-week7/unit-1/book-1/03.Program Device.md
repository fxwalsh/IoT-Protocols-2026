# Install Blynk Library on the Raspberry Pi 3 B+

We will use ``Python`` Blynk library to control the RPi.


## Create your Blynk App


+ SSH into your Raspberry Pi and make a new folder for your Blynk project, *~/blynklab/*.


+ At the command line, run the following to install the Blynk dependencies for Python 3

~~~text
sudo pip install https://bit.ly/3C0PMVY
~~~

+ In the ``~/blynklab/`` folder, create a new file called ``blynk.py`` with the following content, replacing the value assigned to YOUR_BLYNK_AUTH with your auth key:

```python
import BlynkLib
from time import sleep

# Blynk authentication token
BLYNK_AUTH = 'YOUR_BLYNK_AUTH'

# Initialise the Blynk instance
blynk = BlynkLib.Blynk(BLYNK_AUTH)

# Register handler for virtual pin V1 write event
@blynk.on("V1")
def handle_v1_write(value):
    button_value = value[0]
    print(f'Current swith value: {button_value}')

# Main loop to keep the Blynk connection alive and process events
if __name__ == "__main__":
    print("Blynk application started. Listening for events...")
    try:
        while True:
            blynk.run()  # Process Blynk events
            sleep(2)  # Add a short delay to avoid high CPU usage
    except KeyboardInterrupt:
        print("Blynk application stopped.")
```

+ To find  ``YOUR-AUTH-TOKEN`` , In Devices list,:
  
  1. select your device the then select the **Developer Tools ** icon.
  2. Locate the **Auth Token** in the banner an click it to copy."
  
  
  <img src="./img/03.Program Device/image-20241124102532166.png" alt="image-20241124102532166" style="zoom:67%;" />

The above script creates a ``Virtual Pin`` on your Raspberry Pi. You can use this to interface, display and send data with your Blynk app on your phone.

+ Run the script by opening a terminal window and entering ``python blynk.py`` at the command line. You should see the following output:

![Blynk Node connection](./img/blynk1.png)

+ Leave the program running on the RPi 

+ Go back to the Blynk Management App in the browser and select the "Dashboard" tab. Toggle the button control a few times on the Dashboard. You should see the values come through on the RPi. You can now control stuff on the RPi from this dashboard, from any browser, if you wish!
  <img src="./img/03.Program Device/image-20241124102709727.png" alt="image-20241124102709727" style="zoom:67%;" />
  
  

## Relay

Next let's hook up the Relay to the virtual pin .

+ On the RPi, do a keyboard interrupt(ctrl+c) to stop the program.
+ Connect your relay to your Raspberry Pi just like you did in [Soil Moisture Lab](https://tutors.dev/lab/iot-standards-protocols-2025/topic-03/book-01/Control%20Relay)
+ In *blynk.py* add the following to the top of the script(just under the ``from time import sleep``):

~~~python
from grove.grove_relay import GroveRelay

#initialise Relay
relay = GroveRelay(5)

~~~

+ In *blynk.py*, locate the ``def handle_v1_write(value):`` function.  Add the following conditional statement under the ``print(f"....)`` statement:

 ~~~ python if button_value=="1":
     if button_value=="1":
         relay.on()
     else:
         relay.off()
 ~~~

Make sure to match the indentation of the function. 

+ Go back to the Blynk Management App in the browser and select the "Dashboard" tab. Toggle the button control a few times on the Dashboard. You should now hear the relay click on/off.
  ðŸ˜€ Your Blynk Dashboard from the browser is controlling a relay. You can now control power to any electrical device(lights/motors etc.) using the dashboard. 

There's not much change to the code here apart from introducing the Grove library to control the relay. In the next step, we'll do this from a Blynk Mobile phone app.

