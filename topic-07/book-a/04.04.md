# Glitch App

You have used Glitch in a previous module. You will now use it to create a basic web app that displays the images from our RPi camera and updates dynamically when a new image is uploaded. We can do this by creating a connection to the Realtime DB.

+ Go to https://glitch.com/ and create a new project in Glitch, choosing the "Hello-webpage" template
  ![](./img/hello.png)
+ Once created, Make the project private for now as we will be exposing your API key in the Javascript. Click "Share" and 
  ![](./img/private.png)
  ![](./img/g1.png)
+ Open index.html and replace with the following:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>YourPiAtHome</title>

    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css" />
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>
    <!-- import the webpage's javascript file -->
    <script src="/script.js" ></script>
  </head>
  <body>
    <h1>Raspberry Pi Doorbell Cam</h1>

    <p>
      Ima taken at your front door at <span id="time"></span>: <br>
      <img id="photo" />
    </p>


  </body>
</html>
```
Notice that the html ``<body>`` is very simple. The main thing here is the import of the Firebase Javascript libraries. These imports were just copied/pasted from Firebase app in the console. We will use these libraries in the script to connect to Firebase from the Web App. 

+ Replace the ``script.js`` contents with the following:
```javascript
// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBzMetryteryAXcUJdLQ_TVzGvSJVFIzY",
    authDomain: "testertyrteytreyrteapp.com",
    databaseURL: "httertytreytreytreseio.com",
    projectId: "tertytreya2",
storageBucket: "tesertretre.appspot.com",
  messagingSenderId: "24ertytreyre697",
  appId: "1:246516ertytreyrteytrec8bdbf787087b8",
  measurementId: "ertytreytrN"
};

firebase.initializeApp(firebaseConfig);

// Get a reference to the file storage service
const storage = firebase.storage();
// Get a reference to the database service
const database = firebase.database();

// Create camera database reference
const camRef = database.ref("file");

// Sync on any updates to the DB. THIS CODE RUNS EVERY TIME AN UPDATE OCCURS ON THE DB.
camRef.limitToLast(1).on("value", function(snapshot) {
  snapshot.forEach(function(childSnapshot) {
    const image = childSnapshot.val()["image"];
    const time = childSnapshot.val()["timestamp"];
    const storageRef = storage.ref(image);

    storageRef
      .getDownloadURL()
      .then(function(url) {
        console.log(url);
        document.getElementById("photo").src = url;
        document.getElementById("time").innerText = time;
      })
      .catch(function(error) {
        console.log(error);
      });
  });
});

```
You now need to replace the firebaseConfig in script.js with your own one from Firebase. 
+ Go to your Firebase Console and in your SensePi project, click on the *RPiCamApp* and click on settings icon:
  <img src="./img/set2.PNG" alt="image-20221123094922841" style="zoom:50%;" />
+ scroll down to the Firebase SDK snippet section and replace the ``firebaseConfig`` variable in you Glitch  *script.js* file with this one. 
  ![](./img/gli.png)

+ Finally, preview your Glitch app in a browser, then click on the button on the RPi. You should see the last picture taken by the RPi displayed in your Glitch app. Click on the button and you should see the image update dynamically in the browser(i.e you don't have to refresh the page). 
  ![](./img/gli2.png)