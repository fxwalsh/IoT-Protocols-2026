# Exercises

## More data...
+ In Thingspeak, go to *Channel Settings* for the SensePi channel and enable to more field in the SensePi channel(*Field2 & Field3*) to capture pressure and humidity).

![Hunidity & Pressure](./img/press.png)
+ Scroll to the bottom of *Channel Settings* and click on Clear Data.
+ Update the Python program to include **humidity and pressure** data by updating the ``while True`` loop to the following:

~~~python
# Publish a message to temp every 15 seconds
while True:
    try:
        temp=round(sense.temperature,2)
        pressure=round(sense.pressure,2)
        humidity=round(sense.humidity,2)
        
        payload=f"field1={temp}&field2={humidity}&field3={pressure}"
        mqttc.publish(topic, payload)
        time.sleep(int(config["transmissionInterval"]))
    except:
        logging.info('Interrupted')
        sys.exit(0)
~~~
The above code uses the new [formatted string literal](https://docs.python.org/3.6/reference/lexical_analysis.html#f-strings) (f-string) syntax available in Python 3.6 to insert variable values. An `f` at the beginning of the string tells Python to allow any currently valid variable names as variable names within the string.

+ Run the program and let it write data to the channel. **Leave the program running for the next exercise...**

## Analysis

**Dew point** is the temperature to which air must be cooled to become saturated with water vapor. When air cools to its dew point through contact with a surface that is colder than the air, water will condense on the surface. This calculation could be important for storage environments of goods that must be kept dry. 

In this exercise, you'll create a second analysis channel for Dew point calculation.


+ Create another analysis channel called "Dew Point" with the following details:

>Field 1: Temperature (F)  
Field 2: Humidity  
Field 3: Dew Point  
Location: Add your Current latitude and longitude (use the Web to figure this out)

+ **Return to the *SensePi* channel**. Click on the *Apps->MatLab Analysis* option and enter the following:

>Name: Calculate Dewpoint  
Matlab Code: 

~~~matlab
readChId = 631599; % Channel ID for SensePi channel
writeChId = 906971; % Channel ID for Dew channel
readKey = 'XXXXXXXXXXX'; % Read key for SensePi channel
writeKey = 'XXXXXXXXXX';  % Write key for Dew Point Channel
[temp,time] = thingSpeakRead(readChId,'Fields',1,'NumPoints',1,'Readkey',readKey);
humidity = thingSpeakRead(readChId,'Fields',2,'NumPoints',1,'Readkey',readKey);
b = 17.62;
c = 243.5;
gamma = log(humidity/100) + b*temp./(c+temp);
dewPoint = c*gamma./(b-gamma)
thingSpeakWrite(writeChId,[temp,humidity,dewPoint],'Fields',[1,2,3],'Writekey',writeKey);
~~~

+ Click *Save and Run*. Any errors will be indicated in the *output* field.

+ Check your code executed successfully, go to the Dew Point Measurement channel in the Channel Info panel.

 You can  shedule analysis code to run based on React or Time. You will now use the TimeControl app to schedule the dew point calculation in your MATLAB Analysis code. Schedule it to read data from the weather station every 2 minutes and calculate the dew point. (in reality, you'd probably do it less frequently.)

+ Scroll to the bottom of your MATLAB Analysis Dew Point Calculation page. Click ``TimeControl`` to open the app. MATLAB Analysis will be preselected in the Actions field and the Dew Point Calculation as the Code to execute.

+ Name your new TimeControl **Dew Point Control**

+ Choose Recurring in the Frequency field.

+ Choose Minute in the Recurrence field.

+ Select 5 in the Every â€” minutes field.

+ Keep the Start Time at the default value.

![Dew Point Time Control](./img/dew.png)

Verify that the Action is MATLAB Analysis, and the Code to execute is your Dew Point Calculation.

+ Click "Save TimeControl". The analysis will now happen automatically every 5 minutes.  

